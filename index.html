<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙØ±ÙŠØ´ - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ø§Ù„</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #FF0000 0%, #CC0000 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            width: 100%;
            max-width: 500px;
            text-align: center;
        }
        
        .logo {
            width: 180px;
            margin-bottom: 25px;
            border-radius: 10px;
        }
        
        h1 {
            color: #FF0000;
            margin-bottom: 30px;
            font-size: 28px;
            font-weight: bold;
        }
        
        .search-box {
            position: relative;
            margin-bottom: 20px;
        }
        
        .search-input {
            width: 100%;
            padding: 15px 50px 15px 20px;
            border: 2px solid #ddd;
            border-radius: 25px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #FF0000;
            box-shadow: 0 0 10px rgba(255, 0, 0, 0.3);
        }
        
        .search-btn {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: #FF0000;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 18px;
        }
        
        .search-btn:hover {
            background: #CC0000;
            transform: translateY(-50%) scale(1.1);
        }
        
        .qr-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        .qr-btn {
            background: #FF0000;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .qr-btn:hover {
            background: #CC0000;
            transform: translateY(-2px);
        }

        #qr-scanner {
            width: 100%;
            max-width: 300px;
            margin: 0 auto;
            display: none;
        }

        #qr-video {
            width: 100%;
            border-radius: 10px;
            border: 3px solid #FF0000;
        }

        #qr-result {
            margin-top: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            color: #FF0000;
            font-weight: bold;
        }

        .camera-permission {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <img src="https://raw.githubusercontent.com/Minakhairat/fresh-employees/refs/heads/main/Fresh_Electric%20(1).jpg" 
             alt="ÙØ±ÙŠØ´" 
             class="logo">
        <h1>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ø§Ù„ - Ù…ØµÙ†Ø¹ Ø§Ù„Ù…Ø¨Ø±Ø¯ Ø§Ù„ØµØ­Ø±Ø§ÙˆÙŠ</h1>
        
        <div class="search-box">
            <input type="text" 
                   class="search-input" 
                   id="employeeCode"
                   placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø´Ø®ØµÙŠ Ù„Ù„Ø¹Ø§Ù…Ù„...">
            <button class="search-btn" onclick="searchEmployee()">
                ğŸ”
            </button>
        </div>
        
        <div class="qr-section">
            <button class="qr-btn" onclick="toggleQRScanner()">
                ğŸ“· Ù…Ø³Ø­ QR Code
            </button>
            
            <div class="camera-permission">
                âš ï¸ Ø³ÙŠØªÙ… Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
            </div>
            
            <div id="qr-scanner">
                <video id="qr-video" playsinline></video>
            </div>
            <div id="qr-result"></div>
        </div>
    </div>

    <!-- Ù…ÙƒØªØ¨Ø© JsQR -->
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>

    <script>
        let video = null;
        let canvas = null;
        let context = null;
        let isScanning = false;
        let scanInterval = null;

        function searchEmployee() {
            const code = document.getElementById('employeeCode').value.trim();
            
            if (!code) {
                alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø´Ø®ØµÙŠ');
                return;
            }
            
            window.location.href = `employees/${code}.html`;
        }

        async function toggleQRScanner() {
            const scanner = document.getElementById('qr-scanner');
            const result = document.getElementById('qr-result');
            const qrBtn = document.querySelector('.qr-btn');

            if (!isScanning) {
                // ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø§Ø³Ø­
                try {
                    await startQRScanner();
                    scanner.style.display = 'block';
                    qrBtn.innerHTML = 'ğŸ›‘ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø³Ø­';
                    result.innerHTML = 'ğŸ” Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø³Ø­...';
                    isScanning = true;
                } catch (error) {
                    result.innerHTML = 'âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§: ' + error.message;
                }
            } else {
                // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø§Ø³Ø­
                stopQRScanner();
                scanner.style.display = 'none';
                qrBtn.innerHTML = 'ğŸ“· Ù…Ø³Ø­ QR Code';
                result.innerHTML = '';
                isScanning = false;
            }
        }

        async function startQRScanner() {
            const video = document.getElementById('qr-video');
            const result = document.getElementById('qr-result');

            // Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
            const stream = await navigator.mediaDevices.getUserMedia({ 
                video: { 
                    facingMode: "environment",
                    width: { ideal: 1280 },
                    height: { ideal: 720 }
                } 
            });

            video.srcObject = stream;
            await video.play();

            // Ø¥Ù†Ø´Ø§Ø¡ canvas Ù„Ù„ØªØ­Ù„ÙŠÙ„
            canvas = document.createElement('canvas');
            context = canvas.getContext('2d');

            // Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø³Ø­
            scanInterval = setInterval(() => {
                if (video.readyState === video.HAVE_ENOUGH_DATA) {
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    
                    context.drawImage(video, 0, 0, canvas.width, canvas.height);
                    
                    const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
                    const code = jsQR(imageData.data, imageData.width, imageData.height);
                    
                    if (code) {
                        result.innerHTML = `âœ… ØªÙ… Ù…Ø³Ø­ Ø§Ù„ÙƒÙˆØ¯: ${code.data}`;
                        result.style.color = '#28a745';
                        
                        // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØµÙØ­Ø© Ø§Ù„Ø¹Ø§Ù…Ù„ Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØªÙŠÙ†
                        setTimeout(() => {
                            window.location.href = `employees/${code.data}.html`;
                        }, 2000);
                        
                        stopQRScanner();
                    }
                }
            }, 100);
        }

        function stopQRScanner() {
            if (scanInterval) {
                clearInterval(scanInterval);
                scanInterval = null;
            }
            
            const video = document.getElementById('qr-video');
            if (video && video.srcObject) {
                const tracks = video.srcObject.getTracks();
                tracks.forEach(track => track.stop());
                video.srcObject = null;
            }
            
            const qrBtn = document.querySelector('.qr-btn');
            if (qrBtn) {
                qrBtn.innerHTML = 'ğŸ“· Ù…Ø³Ø­ QR Code';
            }
            
            const scanner = document.getElementById('qr-scanner');
            if (scanner) {
                scanner.style.display = 'none';
            }
            
            isScanning = false;
        }

        // Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Enter
        document.getElementById('employeeCode').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchEmployee();
            }
        });

        // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø¹Ù†Ø¯ Ù…ØºØ§Ø¯Ø±Ø© Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('beforeunload', stopQRScanner);
    </script>
</body>
</html>
